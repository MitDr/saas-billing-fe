<form (ngSubmit)="onSubmit()" [formGroup]="formGroup()" nz-form>
  <nz-form-item>
    <nz-form-label [nzSm]="6" [nzXs]="24" nzFor="startDate" nzRequired>Start Date</nz-form-label>
    <nz-form-control [nzSm]="14" [nzXs]="24">
      <nz-date-picker
        [nzFormat]="'dd-MM-yyyy HH:mm:ss'"
        class="w-full" formControlName="startDate"
        id="startDate"
        nzAllowClear
        nzPlaceHolder="Choose start date"
        nzShowTime
      ></nz-date-picker>
    </nz-form-control>
  </nz-form-item>
  <nz-form-item>
    <nz-form-label [nzSm]="6" [nzXs]="24" nzFor="endDate" nzRequired>End Date</nz-form-label>
    <nz-form-control [nzSm]="14" [nzXs]="24">
      <nz-date-picker
        [nzFormat]="'dd-MM-yyyy HH:mm:ss'"
        class="w-full" formControlName="endDate"
        id="endDate"
        nzAllowClear
        nzPlaceHolder="Choose end date"
        nzShowTime
      ></nz-date-picker>
    </nz-form-control>
  </nz-form-item>
  <nz-form-item>
    <nz-form-label [nzSm]="6" [nzXs]="24" nzFor="status" nzRequired>Status</nz-form-label>
    <nz-form-control [nzSm]="14" [nzXs]="24" nzErrorTip="Status is required">
      <nz-select formControlName="status" nzPlaceHolder="Status">
        @for (opt of options; track opt.value) {
          <nz-option [nzLabel]="opt.label" [nzValue]="opt.value"></nz-option>
        }
      </nz-select>
    </nz-form-control>
  </nz-form-item>
  <nz-form-item>
    <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired>Tenant</nz-form-label>
    <nz-form-control [nzSm]="14" [nzXs]="24">
      <button (click)="openTenantModal()" nz-button nzType="default" type="button">
        <span nz-icon nzType="container"></span> Choose Tenant
      </button>

      @if (selectedTenant(); as tenant) {
        <nz-card class="mt-3" nzHoverable>
          <nz-card-meta
            nzTitle="{{ tenant.name }}"
            nzDescription="{{ tenant.id }} • {{ tenant.email }}"
          ></nz-card-meta>
          <button type="button" nz-button nzType="link" nzDanger (click)="clearTenant()">Delete</button>
        </nz-card>
      } @else {
        <p class="text-gray-500 mt-2">Tenant is not chosen</p>
      }
    </nz-form-control>
  </nz-form-item>
  <nz-form-item>
    <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired>Feature</nz-form-label>
    <nz-form-control [nzSm]="14" [nzXs]="24">
      <button (click)="openFeatureModal()" nz-button nzType="default" type="button">
        <span nz-icon nzType="bulb"></span> Choose Feature
      </button>
      @if (selectedFeature(); as feat) {
        <nz-card class="mt-3" nzHoverable>
          <nz-card-meta
            nzTitle="{{ feat.name }}"
            [nzDescription]="getFeatureDescription(feat)"
          ></nz-card-meta>
          <button type="button" nz-button nzType="link" nzDanger (click)="clearFeature()">Delete</button>
        </nz-card>
      } @else {
        <p class="text-gray-500 mt-2">Feature is not chosen</p>
      }
    </nz-form-control>
  </nz-form-item>
  <nz-form-item>
    <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired>Subscription</nz-form-label>
    <nz-form-control [nzSm]="14" [nzXs]="24">
      <button (click)="openSubscriptionModal()" nz-button nzType="default" type="button">
        <span nz-icon nzType="wallet"></span> Choose Subscription
      </button>
      @if (selectedSubscription(); as sub) {
        <nz-card class="mt-3" nzHoverable>
          <nz-card-meta
            nzTitle="{{ sub.id }}"
            [nzDescription]="getSubscriptionDescription(sub)"
          ></nz-card-meta>
          <button type="button" nz-button nzType="link" nzDanger (click)="clearSubscription()">Delete</button>
        </nz-card>
      } @else {
        <p class="text-gray-500 mt-2">Subscription is not chosen</p>
      }
    </nz-form-control>
  </nz-form-item>

  <!-- Tenant Name -->
  <!--  <nz-form-item>-->
  <!--    <nz-form-label [nzSm]="6" [nzXs]="24" nzFor="startDate" nzRequired>Start Date</nz-form-label>-->
  <!--    <nz-form-control [nzSm]="14" [nzXs]="24">-->
  <!--      <nz-date-picker formControlName="startDate" id="startDate" nzShowTime/>-->
  <!--    </nz-form-control>-->
  <!--  </nz-form-item>-->


  <!--  &lt;!&ndash; Email &ndash;&gt;-->
  <!--  <nz-form-item>-->
  <!--    <nz-form-label [nzSm]="6" [nzXs]="24" nzFor="email" nzRequired>Email liên hệ</nz-form-label>-->
  <!--    <nz-form-control [nzSm]="14" [nzXs]="24" nzErrorTip="Email không hợp lệ">-->
  <!--      <input formControlName="email" id="email" nz-input placeholder="email@tenant.com"/>-->
  <!--    </nz-form-control>-->
  <!--  </nz-form-item>-->

  <!--  &lt;!&ndash; Creator: Button mở modal + preview &ndash;&gt;-->
  <!--  <nz-form-item>-->
  <!--    <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired>Người tạo (Creator)</nz-form-label>-->
  <!--    <nz-form-control [nzSm]="14" [nzXs]="24">-->
  <!--      <button (click)="openCreatorModal()" nz-button nzType="default" type="button">-->
  <!--        <span nz-icon nzType="user-add"></span> Chọn Creator-->
  <!--      </button>-->

  <!--      @if (selectedCreator(); as creator) {-->
  <!--        <nz-card class="mt-3" nzHoverable>-->
  <!--          <nz-card-meta-->
  <!--            nzTitle="{{ creator.username }}"-->
  <!--            nzDescription="{{ creator.email }} • {{ creator.role || 'User' }}"-->
  <!--          ></nz-card-meta>-->
  <!--          <button nz-button nzType="link" nzDanger (click)="clearCreator()">Xóa lựa chọn</button>-->
  <!--        </nz-card>-->
  <!--      } @else {-->
  <!--        <p class="text-gray-500 mt-2">Chưa chọn creator</p>-->
  <!--      }-->
  <!--    </nz-form-control>-->
  <!--  </nz-form-item>-->

  <!--  &lt;!&ndash; Assign Users: Button mở modal + preview tags &ndash;&gt;-->
  <!--  <nz-form-item>-->
  <!--    <nz-form-label [nzSm]="6" [nzXs]="24">Gán Users</nz-form-label>-->
  <!--    <nz-form-control [nzSm]="14" [nzXs]="24">-->
  <!--      <button (click)="openUsersModal()" nz-button nzType="default" type="button">-->
  <!--        <span nz-icon nzType="team"></span> Chọn Users-->
  <!--      </button>-->

  <!--      <div class="mt-3 flex flex-wrap gap-2">-->
  <!--        @for (user of selectedUsers(); track user.id) {-->
  <!--          <nz-tag-->
  <!--            nzColor="geekblue"-->
  <!--            nzClosable-->
  <!--            (nzOnClose)="removeSelectedUser(user.id)"-->
  <!--          >-->
  <!--            {{ user.username }} ({{ user.email }}) • {{ user.role || 'User' }}-->
  <!--          </nz-tag>-->
  <!--        }-->
  <!--        @if (selectedUsers().length === 0) {-->
  <!--          <p class="text-gray-500">Chưa chọn user nào</p>-->
  <!--        }-->
  <!--      </div>-->
  <!--      <p class="text-xs text-gray-500 mt-1">-->
  <!--        Các user được chọn sẽ tự động thuộc tenant này.-->
  <!--      </p>-->
  <!--    </nz-form-control>-->
  <!--  </nz-form-item>-->

  <!--  &lt;!&ndash; Current & Pending Amount &ndash;&gt;-->
  <!--  <nz-form-item>-->
  <!--    <nz-form-label [nzSm]="6" [nzXs]="24">Số dư hiện tại</nz-form-label>-->
  <!--    <nz-form-control [nzSm]="14" [nzXs]="24">-->
  <!--      <input formControlName="currentAmount" min="0" nz-input placeholder="0" type="number"/>-->
  <!--    </nz-form-control>-->
  <!--  </nz-form-item>-->

  <!--  <nz-form-item>-->
  <!--    <nz-form-label [nzSm]="6" [nzXs]="24">Số dư chờ xử lý</nz-form-label>-->
  <!--    <nz-form-control [nzSm]="14" [nzXs]="24">-->
  <!--      <input formControlName="pendingAmount" min="0" nz-input placeholder="0" type="number"/>-->
  <!--    </nz-form-control>-->
  <!--  </nz-form-item>-->

  <!--  &lt;!&ndash; API Key (edit mode) &ndash;&gt;-->
  <!--  @if (isEditMode()) {-->
  <!--    <nz-form-item>-->
  <!--      <nz-form-label [nzSm]="6" [nzXs]="24">API Key (Chỉ đọc)</nz-form-label>-->
  <!--      <nz-form-control [nzSm]="14" [nzXs]="24">-->
  <!--        @let currentApiKey = apiKeyValue();-->

  <!--        <div class="flex items-center gap-3">-->
  <!--          <nz-tag nzColor="processing" class="font-mono">-->
  <!--            {{ maskedApiKey() }}-->
  <!--          </nz-tag>-->

  <!--          <button-->
  <!--            nz-button-->
  <!--            nzType="text"-->
  <!--            nzShape="circle"-->
  <!--            (click)="copyApiKey(currentApiKey)"-->
  <!--            nz-tooltip-->
  <!--            nzTooltipTitle="Copy full API Key"-->
  <!--          >-->
  <!--            <span nz-icon nzType="copy"></span>-->
  <!--          </button>-->

  <!--          <button-->
  <!--            nz-button-->
  <!--            nzType="text"-->
  <!--            nzShape="circle"-->
  <!--            nz-popconfirm-->
  <!--            nzPopconfirmTitle="Tạo lại API Key mới? Key cũ sẽ vô hiệu hóa."-->
  <!--            (nzOnConfirm)="refreshApiKey()"-->
  <!--            nz-tooltip-->
  <!--            nzTooltipTitle="Tạo lại API Key"-->
  <!--          >-->
  <!--            <span nz-icon nzType="sync" class="text-orange-600"></span>-->
  <!--          </button>-->
  <!--        </div>-->
  <!--      </nz-form-control>-->
  <!--    </nz-form-item>-->
  <!--  }-->

  <!--  &lt;!&ndash; Submit &ndash;&gt;-->
  <nz-form-item class="mt-8" nz-row>
    <nz-form-control [nzOffset]="6" [nzSpan]="14">
      <button
        [disabled]="formGroup()?.invalid || isLoading()"
        [nzLoading]="isLoading()"
        nz-button
        nzType="primary"
      >
        {{ submitLabel() }}
      </button>
    </nz-form-control>
  </nz-form-item>
</form>

<!--&lt;!&ndash; Modal Creator &ndash;&gt;-->
<nz-modal
  (nzOnCancel)="isTenantModalOpen.set(false)"
  (nzOnOk)="isTenantModalOpen.set(false)"
  [nzVisible]="isTenantModalOpen()"
  nzCancelText="Đóng"
  nzOkText="Xác nhận"
  nzTitle="Chọn Tenant"
>
  <ng-template nzModalContent>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-h-96 overflow-y-auto">
      @if (availableTenants().length === 0) {
        <p class="text-center text-gray-500 py-10">Không có tenant nào để chọn</p>
      } @else {
        @for (tenant of availableTenants(); track tenant.id) {
          <nz-card nzHoverable (click)="selectTenant(tenant)">
            <nz-card-meta
              nzTitle="{{ tenant.name }}"
              nzDescription="{{ tenant.id }} • {{ tenant.email}}"
            ></nz-card-meta>
          </nz-card>
        }
      }
    </div>
  </ng-template>
</nz-modal>
<nz-modal
  (nzOnCancel)="isFeatureModalOpen.set(false)"
  (nzOnOk)="isFeatureModalOpen.set(false)"
  [nzVisible]="isFeatureModalOpen()"
  nzCancelText="Đóng"
  nzOkText="Xác nhận"
  nzTitle="Chọn Feature"
>
  <ng-template nzModalContent>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-h-96 overflow-y-auto">
      @if (availableFeatures().length === 0) {
        <p class="text-center text-gray-500 py-10">Không có feature nào để chọn</p>
      } @else {
        @for (feat of availableFeatures(); track feat.id) {
          <nz-card nzHoverable (click)="selectFeature(feat)">
            <nz-card-meta
              nzTitle="{{ feat.name }}"
              [nzDescription]="getFeatureDescription(feat)"
            ></nz-card-meta>
          </nz-card>
        }
      }
    </div>
  </ng-template>
</nz-modal>
<nz-modal
  (nzOnCancel)="isSubscriptionModalOpen.set(false)"
  (nzOnOk)="isSubscriptionModalOpen.set(false)"
  [nzVisible]="isSubscriptionModalOpen()"
  nzCancelText="Đóng"
  nzOkText="Xác nhận"
  nzTitle="Chọn Subscription"
>
  <ng-template nzModalContent>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-h-96 overflow-y-auto">
      @if (availableSubscription().length === 0) {
        <p class="text-center text-gray-500 py-10">Không có subscription nào để chọn</p>
      } @else {
        @for (sub of availableSubscription(); track sub.id) {
          <nz-card nzHoverable (click)="selectSubscription(sub)">
            <nz-card-meta
              nzTitle="{{ sub.id }}"
              [nzDescription]="getSubscriptionDescription(sub)"
            ></nz-card-meta>
          </nz-card>
        }
      }
    </div>
  </ng-template>
</nz-modal>

<!--&lt;!&ndash;Modal Assign Users&ndash;&gt;-->
<!--&lt;!&ndash; Modal Assign Users &ndash;&gt;-->
<!--<nz-modal-->
<!--  (nzOnCancel)="isUsersModalOpen.set(false)"-->
<!--  (nzOnOk)="isUsersModalOpen.set(false)"-->
<!--  [nzVisible]="isUsersModalOpen()"-->
<!--  nzCancelText="Đóng"-->
<!--  nzOkText="Xác nhận"-->
<!--  nzTitle="Chọn Users để Gán"-->
<!--&gt;-->
<!--  <ng-template nzModalContent>-->
<!--    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-h-96 overflow-y-auto p-4">-->
<!--      @if (availableUsers().length === 0) {-->
<!--        <div class="col-span-full text-center py-10 text-gray-500">-->
<!--          <nz-icon nzType="usergroup-delete" class="text-5xl mb-4"></nz-icon>-->
<!--          <p class="text-lg">Không có user nào để chọn</p>-->
<!--          <p class="text-sm mt-2">Có thể chưa có user trong hệ thống hoặc đang tải dữ liệu.</p>-->
<!--        </div>-->
<!--      } @else {-->
<!--        @for (user of availableUsers(); track user.id) {-->
<!--          <nz-card nzHoverable class="relative cursor-pointer" (click)="toggleUser(user)">-->
<!--            <label-->
<!--              nz-checkbox-->
<!--              class="absolute top-3 right-3 z-10"-->
<!--              [nzChecked]="isUserSelected(user.id)"-->
<!--              (nzCheckedChange)="toggleUser(user)"-->
<!--            ></label>-->

<!--            <nz-card-meta-->
<!--              nzTitle="{{ user.username || 'Unknown' }}"-->
<!--              nzDescription="{{ user.email }} • {{ user.role || 'User' }}"-->
<!--            ></nz-card-meta>-->
<!--          </nz-card>-->
<!--        }-->
<!--      }-->
<!--    </div>-->
<!--  </ng-template>-->
<!--</nz-modal>-->
