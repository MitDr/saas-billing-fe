<nz-card [nzBordered]="false" class="entity-card">
  <div class="flex items-start gap-6">
    <div class="flex-1">
      <!-- Tên Tenant + Status -->
      <h2 class="text-2xl font-bold flex items-center gap-3">
        {{ tenant().name }}
        @if (tenant().softDelete) {
          <nz-tag nzColor="orange">Soft Deleted</nz-tag>
        } @else {
          <nz-tag nzColor="green">Active</nz-tag>
        }
      </h2>

      <!-- Email + Creator ngắn gọn -->
      <p class="text-gray-500 mt-1">
        {{ tenant().email }}
        <span class="ml-4 text-sm text-gray-400">
          Created by <strong>{{ tenant().creator?.username || 'N/A' }}</strong>
        </span>
      </p>

      <!-- Thông tin chính (không có phần users count nữa) -->
      <nz-descriptions [nzColumn]="2" class="mt-6" nzBordered nzSize="small">
        <nz-descriptions-item nzTitle="Tenant ID">
          #{{ tenant().id }}
        </nz-descriptions-item>
        <nz-descriptions-item nzTitle="API Key">
          <div class="flex items-center gap-3">
            <!-- Hiển thị API Key đã mask -->
            <nz-tag class="font-mono" nzColor="processing">
              {{ maskApiKey(tenant().apiKey) }}
            </nz-tag>

            <!-- Nút Copy -->
            <button
              (click)="copyApiKey(tenant().apiKey)"
              nz-button
              nz-tooltip
              nzShape="circle"
              nzTooltipTitle="Copy API Key"
              nzType="text"
            >
              <span nz-icon nzType="copy"></span>
            </button>

            <!-- Nút Refresh -->
            <button
              (nzOnConfirm)="refreshApiKey()"
              nz-button
              nz-popconfirm
              nz-tooltip
              nzPopconfirmTitle="Bạn có chắc muốn tạo lại API Key mới? API Key cũ sẽ không còn hiệu lực."
              nzShape="circle"
              nzTooltipTitle="Refresh / Regenerate API Key"
              nzType="text"
            >
              <span class="text-orange-600" nz-icon nzType="sync"></span>
            </button>
          </div>
        </nz-descriptions-item>

        <!--        <nz-descriptions-item nzTitle="API Key">-->
        <!--          <nz-tag nzColor="processing">-->
        <!--            {{ maskApiKey(tenant().apiKey) }}-->
        <!--          </nz-tag>-->
        <!--        </nz-descriptions-item>-->

        <nz-descriptions-item nzTitle="Stripe Account">
          <nz-tag nzColor="magenta">
            {{ tenant().stripeAccountId }}
          </nz-tag>
        </nz-descriptions-item>

        <nz-descriptions-item nzTitle="Current Balance">
          <span class="font-medium text-green-600">
            ${{ (tenant().currentAmount || 0) | number:'1.0-0' }}
          </span>
        </nz-descriptions-item>

        <nz-descriptions-item nzTitle="Pending Amount">
          <span class="font-medium text-orange-600">
            ${{ (tenant().pendingAmount || 0) | number:'1.0-0' }}
          </span>
        </nz-descriptions-item>

        <nz-descriptions-item nzTitle="Created Date">
          {{ tenant().createdDate }}
        </nz-descriptions-item>

        <nz-descriptions-item nzTitle="Last Modified">
          {{ tenant().modifiedDate }}
        </nz-descriptions-item>
      </nz-descriptions>

      <!-- Actions -->
      <div class="mt-8 flex flex-wrap gap-3">
        <button [routerLink]="['/admin/tables/tenants', tenant().id, 'edit']" class="!inline-flex !items-center"
                nz-button
                nzType="primary">
          <span nz-icon nzType="edit"></span>
          Edit Tenant
        </button>

        <button (click)="onDelete()" class="!inline-flex !items-center"
                nz-button
                nzDanger>
          <span nz-icon nzType="delete"></span>
          Delete Tenant
        </button>
        <!--        @if (tenant().stripeAccountId) {-->
        <!--          <button nz-button nzType="default"-->
        <!--                  class="!inline-flex !items-center">-->
        <!--            <span nz-icon nzType="link"></span>-->
        <!--            Update Account Link-->
        <!--          </button>-->
        <!--        }-->
      </div>

      <!-- Phần Users: tái sử dụng User Card -->
      @if (tenant().users?.length) {
        <div class="mt-10">
          <h3 class="text-xl font-semibold mb-6 flex items-center gap-3">
            <span nz-icon nzType="team" class="text-blue-600"></span>
            Users in this Tenant ({{ tenant().users.length }})
          </h3>

          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            @for (user of tenant().users; track user.id) {
              <app-user-dto-card [numberOfColumn]="1" [user]="user"
                                 (userRemove)="onRemoveUser($event)">
              </app-user-dto-card>
            }
          </div>
        </div>
      } @else {
        <div class="mt-10 text-center text-gray-500 py-8">
          <nz-icon nzType="team" nzTheme="outline" class="text-4xl opacity-50"></nz-icon>
          <p class="mt-3">No users in this tenant yet.</p>
        </div>
      }
    </div>
  </div>
</nz-card>
