<nz-card [nzBordered]="false" class="tenant-card">
  <div class="flex items-start gap-6">
    <div class="flex-1">
      <!-- Tên Tenant + Status -->
      <h2 class="text-2xl font-bold flex items-center gap-3">
        Number: {{ invoice().invoiceNumber }}
        @if (invoice().softDelete) {
          <nz-tag nzColor="orange">Soft Deleted</nz-tag>
        } @else {
          <nz-tag nzColor="green">Active</nz-tag>
        }
      </h2>

      <!-- Thông tin chính (không có phần users count nữa) -->
      <nz-descriptions [nzColumn]="2" class="mt-6" nzBordered nzSize="small">
        <nz-descriptions-item nzTitle="Invoice ID">
          #{{ invoice().id }}
        </nz-descriptions-item>
        <nz-descriptions-item nzTitle="Invoice Number">
          <div class="flex items-center gap-3">
            <!-- Hiển thị API Key đã mask -->
            <nz-tag class="font-mono" nzColor="processing">
              {{ maskInvoiceNumber(invoice().invoiceNumber) }}
            </nz-tag>
            <!-- Nút Copy -->
            <button
              (click)="copyInvoiceNumber(invoice().invoiceNumber)"
              nz-button
              nz-tooltip
              nzShape="circle"
              nzTooltipTitle="Copy Invoice Number Key"
              nzType="text"
            >
              <span nz-icon nzType="copy"></span>
            </button>
          </div>
        </nz-descriptions-item>
        <nz-descriptions-item nzTitle="Invoice Amount">
          {{ invoice().amount }}
        </nz-descriptions-item>
        <nz-descriptions-item nzTitle="Currency">
          <div class="flex items-center gap-3">
            @switch (invoice().currency) {
              @case ('USD') {
                <nz-tag class="font-mono" nzColor="green">
                  {{ invoice().currency }}
                </nz-tag>
              }
              @case ('VND') {
                <nz-tag class="font-mono" nzColor="red">
                  {{ invoice().currency }}
                </nz-tag>
              }
            }
          </div>
        </nz-descriptions-item>
        <nz-descriptions-item nzTitle="Tenant Status">
          <div class="flex items-center gap-3">
            @switch (invoice().status) {
              @case ('PAID') {
                <nz-tag class="font-mono" nzColor="green">
                  Paid
                </nz-tag>
              }
              @case ('DRAFT') {
                <nz-tag class="font-mono" nzColor="blue">
                  Draft
                </nz-tag>
              }
              @case ('UNPAID') {
                <nz-tag class="font-mono" nzColor="red">
                  Unpaid
                </nz-tag>
              }
              @case ('VOID') {
                <nz-tag class="font-mono" nzColor="gray">
                  Void
                </nz-tag>
              }
            }
          </div>
        </nz-descriptions-item>
        <nz-descriptions-item nzTitle="Paid Date">
          {{ invoice().paidDate }}
        </nz-descriptions-item>
        <nz-descriptions-item nzTitle="Billing Start">
          {{ invoice().billingPeriodStart }}
        </nz-descriptions-item>
        <nz-descriptions-item nzTitle="Billing End">
          {{ invoice().billingPeriodEnd }}
        </nz-descriptions-item>
        <nz-descriptions-item nzTitle="Amount USD">
          {{ invoice().amountUsd }}
        </nz-descriptions-item>
        <nz-descriptions-item nzTitle="Exchange Rate">
          {{ invoice().exchangeRate }}
        </nz-descriptions-item>
        <nz-descriptions-item nzTitle="Created Date">
          {{ invoice().createdDate }}
        </nz-descriptions-item>
        <nz-descriptions-item nzTitle="Last Modified">
          {{ invoice().modifiedDate }}
        </nz-descriptions-item>
        <nz-descriptions-item nzTitle="Soft Delete">
          <nz-tag [nzColor]="invoice().softDelete ? 'geekblue' : 'green'">
            {{ invoice().softDelete }}
          </nz-tag>
        </nz-descriptions-item>
        <nz-descriptions-item nzTitle="Metadata">
          <pre>{{ metadataObject | json }}</pre>
        </nz-descriptions-item>
      </nz-descriptions>
      <!-- Actions -->
      <div class="mt-8 flex flex-wrap gap-3">
        <button [routerLink]="['/admin/tables/invoices', invoice().id, 'edit']"
                class="!inline-flex !items-center" nz-button
                nzType="primary">
          <span nz-icon nzType="edit"></span>
          Edit Invoice
        </button>
        <!--        <button nz-button nzDanger (click)="confirmDelete()">-->
        <button (click)="onDelete()" class="!inline-flex !items-center"
                nz-button nzDanger>
          <span nz-icon nzType="delete"></span>
          Delete Invoice
        </button>
      </div>
      @if (invoice().subscription) {
        <div class="mt-10">
          <h3 class="text-xl font-semibold mb-6 flex items-center gap-3">
            <span nz-icon nzType="wallet" class="text-blue-600"></span>
            Subscription of this Invoice (#{{ invoice().subscription.id }})
          </h3>
          <div class="grid grid-cols-1 gap-6">
            <app-subscription-dto-card [subscription]="invoice().subscription"></app-subscription-dto-card>
          </div>
        </div>
      } @else {
        <div class="mt-10 text-center text-gray-500 py-8">
          <nz-icon nzType="wallet" nzTheme="outline" class="text-4xl opacity-50"></nz-icon>
          <p class="mt-3">No tenant in this Invoice yet.</p>
        </div>
      }
      @if (invoice().subscription) {
        <div class="mt-10">
          <h3 class="text-xl font-semibold mb-6 flex items-center gap-3">
            <span nz-icon nzType="team" class="text-blue-600"></span>
            Subscriber of this Invoice ({{ invoice().subscriber.name }})
          </h3>
          <div class="grid grid-cols-1 gap-6">
            <app-subscriber-dto-card [subscriber]="invoice().subscriber"></app-subscriber-dto-card>
          </div>
        </div>
      } @else {
        <div class="mt-10 text-center text-gray-500 py-8">
          <nz-icon nzType="team" nzTheme="outline" class="text-4xl opacity-50"></nz-icon>
          <p class="mt-3">No tenant in this Invoice yet.</p>
        </div>
      }
      @if (invoice().tenant) {
        <div class="mt-10">
          <h3 class="text-xl font-semibold mb-6 flex items-center gap-3">
            <span nz-icon nzType="container" class="text-blue-600"></span>
            Tenant of this Invoice ({{ invoice().tenant.name }})
          </h3>
          <div class="grid grid-cols-1 gap-6">
            <app-tenant-dto-card [tenant]="invoice().tenant"></app-tenant-dto-card>
          </div>
        </div>
      } @else {
        <div class="mt-10 text-center text-gray-500 py-8">
          <nz-icon nzType="container" nzTheme="outline" class="text-4xl opacity-50"></nz-icon>
          <p class="mt-3">No tenant in this Invoice yet.</p>
        </div>
      }
    </div>
  </div>
</nz-card>
